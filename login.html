<!DOCTYPE html>
<html lang="de" dir="ltr">
<head>
    <meta charset="UTF-8">
    <title>Anmeldung – Apothekenservice</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f5f9ff; display: flex; align-items: center; justify-content: center; height: 100vh; margin:0; }
        .box { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); width: 400px; }
        .tabs { display: flex; margin-bottom: 25px; background: #eee; border-radius: 8px; padding: 5px; }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; border-radius: 6px; font-weight: bold; color: #666; }
        .tab.active { background: white; color: #1a5fb4; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 12px; margin: 10px 0; box-sizing: border-box; border: 1px solid #ddd; border-radius: 8px; text-align: left; }
        .btn { width: 100%; padding: 15px; background: #1a5fb4; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 15px; font-size: 18px; }
        .error { color: #dc3545; background: #f8d7da; padding: 10px; border-radius: 5px; font-size: 14px; margin-top: 15px; display: none; text-align: center; }
    </style>
</head>
<body>
    <div class="box">
        <h2 style="text-align:center; margin-bottom:20px;">Anmelden</h2>
        <div class="tabs">
            <div id="t1" class="tab active" onclick="setRole('pharmacist')">Apotheker</div>
            <div id="t2" class="tab" onclick="setRole('pharmacy')">Apotheke</div>
        </div>
        <input type="email" id="email" placeholder="E-Mail-Adresse">
        <input type="password" id="pass" placeholder="Passwort">
        <div id="err" class="error"></div>
        <button class="btn" onclick="login()">Anmelden</button>
        <div style="text-align:center; margin-top:15px;">
    <a href="forget-password.html" style="color:#1a5fb4; text-decoration:none; font-size:14px;">
        Passwort vergessen?
    </a>
</div>
        <div style="text-align:center; margin-top:20px;">
            <a href="register.html" style="color:#1a5fb4; text-decoration:none;">Zurück zur Startseite</a>
        </div>
    </div>

<script>
    // Überprüfen, ob bereits ein Benutzer angemeldet ist
    const userToken = localStorage.getItem('userToken');
    const userType = localStorage.getItem('userType');

    if(userToken && userType) {
        // Wenn vorhanden, direkt zur Startseite weiterleiten (index.html)
        window.location.href = "index.html";
    }
</script>

<script>
    let role = "pharmacist";
    function setRole(r) {
        role = r;
        document.getElementById('t1').classList.toggle('active', r === 'pharmacist');
        document.getElementById('t2').classList.toggle('active', r === 'pharmacy');
    }

    async function login() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('pass').value;
        const errDiv = document.getElementById('err');
        
        if(!email || !password) return alert("Bitte füllen Sie alle Felder aus");
        errDiv.style.display = "none";

        const endpoint = role === "pharmacist" ? "Pharmacist/login" : "Pharmacy/login";

        try {
            const response = await fetch(`https://sirvicesezz.runasp.net/api/${endpoint}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            const result = await response.json();

            if(response.ok) {
                // *** Wichtige Daten speichern ***
                localStorage.setItem('userId', result.id);
                localStorage.setItem('userToken', result.token);
                localStorage.setItem('userType', role);

                // Benutzername speichern (standardmäßig oder vom Server)
                if(role === 'pharmacist') {
                    localStorage.setItem('userName', result.fullName || 'Apotheker');
                } else {
                    localStorage.setItem('userName', result.pharmacyName || 'Apotheke');
                }

                alert("Anmeldung erfolgreich!");
                
                // Weiterleitung zur Startseite (index.html)
                window.location.href = "index.html";
                
            } else {
                errDiv.innerText = "Anmeldefehler: Bitte überprüfen Sie Ihre Daten";
                errDiv.style.display = "block";
            }
        } catch(e) {
            errDiv.innerText = "Verbindung zum Server fehlgeschlagen.";
            errDiv.style.display = "block";
        }
    }
</script>
</body>
</html>
